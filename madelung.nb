b1 = {0, 0, 0};(*basis vectors*)
b2 = {1, 1, 1}*a/2;
a1 = {1, 1, 0}*a/2;(*lattice vectors*)
a2 = {0, 1, 1}*a/2;
a3 = {1, 0, 1}*a/2;
ar1 = 2*Pi/a*{1, 1, -1};(*reciprocal vectors*)
ar2 = 2*Pi/a*{-1, 1, 1};
ar3 = 2*Pi/a*{1, -1, 1};
c = 4/a^2;(*splitting parameter*)
ar = i*ar1 + j*ar2 + k*ar3;
aa = i*a1 + j*a2 + k*a3;
arn = Norm[ar];
an = Norm[aa];
n = 5;(*number of sums*)s1 = 
 Sum[If[i != 0 || j != 0 || k != 0, (1 - Exp[I*ar.b2])*
    Exp[-arn^2/c]/arn^2, 0], {i, -n, n}, {j, -n, n}, {k, -n, n}];
s2 = Sum[If[i != 0 || j != 0 || k != 0, Erfc[Sqrt[c]/2*an]/an, 
    0], {i, -n, n}, {j, -n, n}, {k, -n, n}];
s3 = Sum[Erfc[Sqrt[c]/2*Norm[b2 + aa]]/Norm[b2 + aa], {i, -n, 
    n}, {j, -n, n}, {k, -n, n}];
N[-(-Sqrt[c/Pi] + 16*Pi*s1 + s2 - s3)/2 /. 
  a -> 1] (*Madelung constant*)